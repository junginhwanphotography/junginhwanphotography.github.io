<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Jung In Hwan Photography Portfolio</title>
    <meta
      name="description"
      content="Jung In Hwan의 사진 포트폴리오. 다양한 작품을 한눈에 감상해 보세요."
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="header-inner">
        <div>
          <h1 class="site-title">
            <a href="#" class="site-title-link">Jung In Hwan</a>
          </h1>
          <p class="site-subtitle">Photography Portfolio</p>
        </div>
      </div>
    </header>

    <main>
      <section class="gallery" aria-label="사진 갤러리" id="gallery">
        <!-- images.json을 통해 자동으로 사진이 렌더링됩니다. -->
      </section>
    </main>

    <!-- 클릭 시 확대 보기용 라이트박스 -->
    <div class="lightbox" id="lightbox" aria-hidden="true">
      <div class="lightbox-backdrop" data-lightbox-close></div>
      <figure class="lightbox-content">
        <button
          class="lightbox-nav lightbox-nav-prev"
          type="button"
          aria-label="이전 사진"
          data-lightbox-nav="prev"
        >
          ‹
        </button>
        <img id="lightbox-image" alt="" />
        <button
          class="lightbox-nav lightbox-nav-next"
          type="button"
          aria-label="다음 사진"
          data-lightbox-nav="next"
        >
          ›
        </button>
        <button
          class="lightbox-close"
          type="button"
          aria-label="확대 이미지 닫기"
          data-lightbox-close
        >
          ×
        </button>
      </figure>
    </div>

    <footer class="site-footer">
      <p>© <span id="year"></span> Jung In Hwan. All rights reserved.</p>
    </footer>

    <script>
      // 현재 연도로 자동 업데이트
      document.getElementById("year").textContent = new Date().getFullYear();

      // 전역 변수: 이미지 배열과 현재 인덱스
      let imageList = [];
      let currentImageIndex = -1;

      // images.json을 불러와 갤러리를 채우는 스크립트
      async function loadGallery() {
        const galleryEl = document.getElementById("gallery");
        if (!galleryEl) return;

        try {
          const res = await fetch("images.json", { cache: "no-store" });
          if (!res.ok) {
            console.error("images.json 로드 실패:", res.status);
            return;
          }
          const data = await res.json();
          const images = Array.isArray(data) ? data : data.images;
          if (!Array.isArray(images)) {
            console.error("images.json 형식이 올바르지 않습니다.");
            return;
          }

          // 전역 변수에 이미지 배열 저장
          imageList = images.filter((item) => item && item.src);

          imageList.forEach((item, index) => {
            const figure = document.createElement("figure");
            figure.className = "gallery-item";

            const img = document.createElement("img");
            img.src = item.src;
            img.alt = item.alt || "";
            img.loading = "lazy";

            img.addEventListener("click", () => {
              openLightbox(index);
            });

            figure.appendChild(img);
            galleryEl.appendChild(figure);
          });
        } catch (error) {
          console.error("갤러리 로드 중 오류:", error);
        }
      }

      function openLightbox(index) {
        if (index < 0 || index >= imageList.length) return;

        const lightbox = document.getElementById("lightbox");
        const img = document.getElementById("lightbox-image");
        if (!lightbox || !img) return;

        currentImageIndex = index;
        const item = imageList[index];
        img.src = item.src;
        img.alt = item.alt || "";

        updateNavButtons();

        lightbox.classList.add("is-open");
        lightbox.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
      }

      function closeLightbox() {
        const lightbox = document.getElementById("lightbox");
        if (!lightbox) return;

        lightbox.classList.remove("is-open");
        lightbox.setAttribute("aria-hidden", "true");
        document.body.style.overflow = "";
        currentImageIndex = -1;
      }

      function navigateImage(direction) {
        if (currentImageIndex < 0 || imageList.length === 0) return;

        let newIndex;
        if (direction === "next") {
          newIndex = (currentImageIndex + 1) % imageList.length;
        } else if (direction === "prev") {
          newIndex = (currentImageIndex - 1 + imageList.length) % imageList.length;
        } else {
          return;
        }

        const img = document.getElementById("lightbox-image");
        if (!img) return;

        const item = imageList[newIndex];
        img.src = item.src;
        img.alt = item.alt || "";
        currentImageIndex = newIndex;

        updateNavButtons();
      }

      function updateNavButtons() {
        const prevBtn = document.querySelector(".lightbox-nav-prev");
        const nextBtn = document.querySelector(".lightbox-nav-next");

        if (prevBtn && nextBtn) {
          // 항상 화살표를 보여주지만, 필요하면 숨길 수도 있음
          prevBtn.style.display = imageList.length > 1 ? "flex" : "none";
          nextBtn.style.display = imageList.length > 1 ? "flex" : "none";
        }
      }

      // 라이트박스 이벤트 바인딩
      (function setupLightboxEvents() {
        const lightbox = document.getElementById("lightbox");
        if (!lightbox) return;

        lightbox.addEventListener("click", (event) => {
          const target = event.target;
          if (
            target instanceof HTMLElement &&
            target.hasAttribute("data-lightbox-close")
          ) {
            closeLightbox();
          } else if (
            target instanceof HTMLElement &&
            target.hasAttribute("data-lightbox-nav")
          ) {
            const direction = target.getAttribute("data-lightbox-nav");
            navigateImage(direction);
          }
        });

        window.addEventListener("keydown", (event) => {
          const lightbox = document.getElementById("lightbox");
          if (!lightbox || !lightbox.classList.contains("is-open")) return;

          if (event.key === "Escape") {
            closeLightbox();
          } else if (event.key === "ArrowLeft") {
            navigateImage("prev");
          } else if (event.key === "ArrowRight") {
            navigateImage("next");
          }
        });
      })();

      loadGallery();
    </script>
  </body>
</html>
